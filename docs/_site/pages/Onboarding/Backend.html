<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/main-frosh-logo.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Backend | F!rosh Website Documentation</title> <meta name="generator" content="Jekyll v4.3.2" /> <meta property="og:title" content="Backend" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A GitHub Pages website used to host documentation and resources for UofT orientation website development" /> <meta property="og:description" content="A GitHub Pages website used to host documentation and resources for UofT orientation website development" /> <link rel="canonical" href="http://0.0.0.0:4000/pages/Onboarding/Backend.html" /> <meta property="og:url" content="http://0.0.0.0:4000/pages/Onboarding/Backend.html" /> <meta property="og:site_name" content="F!rosh Website Documentation" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Backend" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A GitHub Pages website used to host documentation and resources for UofT orientation website development","headline":"Backend","url":"http://0.0.0.0:4000/pages/Onboarding/Backend.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> F!rosh Website Documentation </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Getting Started</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Project Architecture category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/pages/Project%20Architecture/ProjectArchitecture.html" class="nav-list-link">Project Architecture</a><ul class="nav-list"><li class="nav-list-item "><a href="/pages/Project%20Architecture/Backend.html" class="nav-list-link">Backend</a></li><li class="nav-list-item "><a href="/pages/Project%20Architecture/Frontend.html" class="nav-list-link">Frontend</a></li><li class="nav-list-item "><a href="/pages/Project%20Architecture/Scunt.html" class="nav-list-link">Havenger Scunt</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in Onboarding category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/pages/Onboarding/Onboarding.html" class="nav-list-link">Onboarding</a><ul class="nav-list"><li class="nav-list-item "><a href="/pages/Onboarding/Frontend.html" class="nav-list-link">Frontend</a></li><li class="nav-list-item active"><a href="/pages/Onboarding/Backend.html" class="nav-list-link active">Backend</a></li><li class="nav-list-item "><a href="/pages/Onboarding/GitHub.html" class="nav-list-link">Git & GitHub</a></li><li class="nav-list-item "><a href="/pages/Onboarding/Security.html" class="nav-list-link">Security</a></li><li class="nav-list-item "><a href="/pages/Onboarding/Docker.html" class="nav-list-link">Docker</a></li><li class="nav-list-item "><a href="/pages/Onboarding/Hosting.html" class="nav-list-link">Hosting & Deployment</a></li><li class="nav-list-item "><a href="/pages/Onboarding/Documentation.html" class="nav-list-link">Documentation</a></li></ul></li><li class="nav-list-item"><a href="/pages/TheTeam.html" class="nav-list-link">The Team</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search F!rosh Website Documentation" aria-label="Search F!rosh Website Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/UofT-Frosh-Orientation/orientation-website/" class="site-button" > Github Repo </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/pages/Onboarding/Onboarding.html">Onboarding</a></li> <li class="breadcrumb-nav-list-item"><span>Backend</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="backend"> <a href="#backend" class="anchor-heading" aria-labelledby="backend"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backend </h1> <p>The backend is comprised of a variety of systems and technologies. The application is a REST API created using Express.js that communicates with services such as a MongoDB for data storage, stripe for payments, and AWS (Amazon Web Services) Simple Email Service (SES)for sending dynamic emails to users. Additionally, Redis is used to hold session data to and to perform asynchronous tasks on the server side. The following will expand on the require skill set to use each of these technologies.</p> <h2 id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h2> <ol class="no_toc text-delta" id="markdown-toc"> <li><a href="#backend" id="markdown-toc-backend">Backend</a> <ol> <li><a href="#table-of-contents" id="markdown-toc-table-of-contents">Table of contents</a></li> <li><a href="#expressjs" id="markdown-toc-expressjs">Express.js</a> <ol> <li><a href="#to-get-a-solid-understanding-of-expressjs-and-its-inner-workings-watch-the-following-videos" id="markdown-toc-to-get-a-solid-understanding-of-expressjs-and-its-inner-workings-watch-the-following-videos"><strong>To Get a solid understanding of Express.js and its inner workings watch the following videos</strong></a></li> <li><a href="#middlewares" id="markdown-toc-middlewares">Middlewares</a></li> <li><a href="#routes--routers" id="markdown-toc-routes--routers">Routes &amp; Routers</a></li> <li><a href="#controllers" id="markdown-toc-controllers">Controllers</a></li> <li><a href="#services" id="markdown-toc-services">Services</a></li> </ol> </li> <li><a href="#redis" id="markdown-toc-redis">Redis</a> <ol> <li><a href="#bull" id="markdown-toc-bull">Bull</a></li> <li><a href="#subscribers" id="markdown-toc-subscribers">Subscribers</a></li> </ol> </li> <li><a href="#mongodb" id="markdown-toc-mongodb">MongoDB</a> <ol> <li><a href="#mongoose" id="markdown-toc-mongoose">Mongoose</a></li> <li><a href="#models--schemas" id="markdown-toc-models--schemas">Models &amp; Schemas</a></li> </ol> </li> <li><a href="#aws-ses" id="markdown-toc-aws-ses">AWS SES</a></li> <li><a href="#stripe" id="markdown-toc-stripe">Stripe</a></li> </ol> </li> </ol><hr /> <h2 id="expressjs"> <a href="#expressjs" class="anchor-heading" aria-labelledby="expressjs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Express.js </h2> <h4 id="to-get-a-solid-understanding-of-expressjs-and-its-inner-workings-watch-the-following-videos"> <a href="#to-get-a-solid-understanding-of-expressjs-and-its-inner-workings-watch-the-following-videos" class="anchor-heading" aria-labelledby="to-get-a-solid-understanding-of-expressjs-and-its-inner-workings-watch-the-following-videos"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>To Get a solid understanding of Express.js and its inner workings watch the following videos</strong> </h4> <ul> <li><a href="https://www.youtube.com/watch?v=SccSCuHhOw0">35 Minute Express.js Tutorial</a></li> <li><a href="https://www.youtube.com/watch?v=-MTSQjw5DrM">REST API Explainer Video through Express.js</a></li> <li><a href="https://www.youtube.com/watch?v=lY6icfhap2o">Middleware Explainer Video</a></li> </ul> <p>Express.js is a Node.js framework that allows users to create a “REST API”. This means that the backend API will respond to HTTP requests such as <code class="language-plaintext highlighter-rouge">GET, POST, EDIT, DELETE</code> to specific routes such as <code class="language-plaintext highlighter-rouge">/users, /info, /announcement/create, ...</code></p> <h3 id="middlewares"> <a href="#middlewares" class="anchor-heading" aria-labelledby="middlewares"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Middlewares </h3> <p>When a request is sent to a specific route it needs to be properly processed until the server can identify what the request is asking for to then provide it with the correct response or in the case of an invalid request, an error. The processing of the data is done through <code class="language-plaintext highlighter-rouge">middlewares</code>. These are functions that take the request data and modify it in specific ways so that a response can be formed. Some middlewares are pre-made and can be used installed through Node.js packages, for example, the <code class="language-plaintext highlighter-rouge">bodyParser</code> middleware is a package that takes the request data and parses the body of the request or the data that was sent along with it and places it into a JSON object. However you can also create your own middlewares, any function that takes in <code class="language-plaintext highlighter-rouge">(request, response, next)</code> as arguments can be a middleware. These functions will execute some code and either modify the <code class="language-plaintext highlighter-rouge">request</code> object and then call <code class="language-plaintext highlighter-rouge">next()</code> which will then pass that information to the next middleware. The <code class="language-plaintext highlighter-rouge">request</code> object continues to get modified by different middlewares until the final middleware terminates the request by changing the <code class="language-plaintext highlighter-rouge">status()</code> of the <code class="language-plaintext highlighter-rouge">response</code> object, The final middleware can also send along data or information back to the user by using <code class="language-plaintext highlighter-rouge">send()</code>.</p> <p>Example middleware and usage:</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Checks whether the user is signed in.
 * @param {Object} req
 * @param {Object} res
 * @param {Function} next
 * @return {*}
 */</span>
<span class="kd">const</span> <span class="nx">checkLoggedIn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span>
      <span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Please sign in to access this route!</span><span class="dl">"</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">checkLoggedIn</span><span class="p">,</span> <span class="nx">otherMiddleware</span><span class="p">,</span> <span class="nx">finalMiddleware</span><span class="p">);</span>
</code></pre></div></div> <p>You can see how in the above message the response is a <code class="language-plaintext highlighter-rouge">403</code> error if the user is not logged in. However, if the user is logged in the <code class="language-plaintext highlighter-rouge">next()</code> function is called to send the data to the next middleware.</p> <h3 id="routes--routers"> <a href="#routes--routers" class="anchor-heading" aria-labelledby="routes--routers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Routes &amp; Routers </h3> <p>Each set of routes get their own router file. Inside each router file a specific route and HTTP request type are mapped to a certain service. To make the codebase more dynamic the connection between the routes and the services are expanded to go through a <code class="language-plaintext highlighter-rouge">controller</code>.</p> <p>Example router:</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">getTimeline</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../controllers/TimelineController</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>

<span class="cm">/**
 * @swagger
 * /timeline:
 *   get:
 *     summary: Get all the timeline events
 *     responses:
 *       '200':
 *         description: Successfully retrieved the timeline events
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 timelines:
 *                   type: array
 *                   items:
 *                     $ref: '#components/schemas/Timeline'
 */</span>
<span class="nx">router</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="nx">getTimeline</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="dl">"</span><span class="s2">/timeline</span><span class="dl">"</span><span class="p">,</span> <span class="nx">router</span><span class="p">);</span>
</code></pre></div></div> <h3 id="controllers"> <a href="#controllers" class="anchor-heading" aria-labelledby="controllers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Controllers </h3> <p>Controllers are specific middlewares used to perform some processing on the HTTP requests before they are sent to <code class="language-plaintext highlighter-rouge">services</code>. In the above example, <code class="language-plaintext highlighter-rouge">getTimeline</code> is one middleware from the timeline controller.</p> <p>Example controller:</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">AnnouncementServices</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../services/AnnouncementServices</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">AnnouncementController</span> <span class="o">=</span> <span class="p">{</span>
  <span class="cm">/**
   * Gets all announcements
   */</span>
  <span class="k">async</span> <span class="nx">getAnnouncement</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">allAnnouncements</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">AnnouncementServices</span><span class="p">.</span><span class="nx">getAllAnnouncements</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">announcements</span><span class="p">:</span> <span class="nx">allAnnouncements</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">next</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="cm">/**
   * Gets all completed announcements of a user
   */</span>
  <span class="k">async</span> <span class="nx">getCompletedAnnouncements</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">currentUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">completedAnnouncements</span> <span class="o">=</span>
        <span class="k">await</span> <span class="nx">AnnouncementServices</span><span class="p">.</span><span class="nx">getCompletedAnnouncements</span><span class="p">(</span><span class="nx">currentUser</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span> <span class="na">announcements</span><span class="p">:</span> <span class="nx">completedAnnouncements</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">next</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="k">async</span> <span class="nx">otherMiddleware</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{...},</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">AnnouncementController</span><span class="p">;</span>

</code></pre></div></div> <h3 id="services"> <a href="#services" class="anchor-heading" aria-labelledby="services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Services </h3> <p>Each service gets one or more file which directly works with the particular technology. However, although MongoDB is one service the majority of the service files use it since different parts of the website have their own section of the database. Each service file contains functions that communicate with their service without any interaction with the HTTP request. The functions return key pieces of information that was received from the service back to the controller.</p> <p>Example service file:</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">SES</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SESv2Client</span><span class="p">({</span> <span class="na">region</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ca-central-1</span><span class="dl">"</span> <span class="p">});</span>

<span class="kd">const</span> <span class="nx">EmailServices</span> <span class="o">=</span> <span class="p">{</span>
  <span class="cm">/**
   * Create and save an email template
   * @param {String} templateName name of the new template
   * @param {String} html html body
   * @param {String} subject subject of the email
   * @param {String} text text body
   * @see {@link https://aws.amazon.com/blogs/messaging-and-targeting/introducing-email-templates-and-bulk-sending/} for the filling of `html` and `text`
   * @returns {Promise} promise
   */</span>
  <span class="k">async</span> <span class="nx">createTemplate</span><span class="p">(</span><span class="nx">templateName</span><span class="p">,</span> <span class="nx">html</span><span class="p">,</span> <span class="nx">subject</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">TemplateContent</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">Html</span><span class="p">:</span> <span class="nx">html</span><span class="p">,</span>
        <span class="na">Subject</span><span class="p">:</span> <span class="nx">subject</span><span class="p">,</span>
        <span class="na">Text</span><span class="p">:</span> <span class="nx">text</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="na">TemplateName</span><span class="p">:</span> <span class="nx">templateName</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">command</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CreateEmailTemplateCommand</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">SES</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="cm">/**
   * Send bulk personalized template emails
   * @param {Object[]} bulkEmailEntries an array containing arrays of email addresses
   * @param {String} templateName name of template used
   * @param {Object} defaultTemplateData defult data to be filled in the template
   * @param {String} fromAddress the email adress the email is being sent from
   * @returns {Promise} promise
   */</span>
  <span class="k">async</span> <span class="nx">sendBulkTemplateEmail</span><span class="p">(</span>
    <span class="nx">bulkEmailEntries</span><span class="p">,</span>
    <span class="nx">templateName</span><span class="p">,</span>
    <span class="nx">defaultTemplateData</span><span class="p">,</span>
    <span class="nx">fromAddress</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">BulkEmailEntries</span><span class="p">:</span> <span class="nx">bulkEmailEntries</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">entry</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="na">Destination</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">ToAddresses</span><span class="p">:</span> <span class="p">[...</span><span class="nx">entry</span><span class="p">],</span>
          <span class="p">},</span>
        <span class="p">};</span>
      <span class="p">}),</span>
      <span class="na">DefaultContent</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">Template</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">TemplateData</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">defaultTemplateData</span><span class="p">),</span>
          <span class="na">TemplateName</span><span class="p">:</span> <span class="nx">templateName</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>

      <span class="na">FromEmailAddress</span><span class="p">:</span> <span class="nx">fromAddress</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">command</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SendBulkEmailCommand</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">SES</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">EmailServices</span><span class="p">;</span>
</code></pre></div></div> <h2 id="redis"> <a href="#redis" class="anchor-heading" aria-labelledby="redis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Redis </h2> <p>Redis is a tool used to keep data in memory. This makes retrieving this data very fast as opposed to making a call to a database. However we use Redis on the backend to hold the information of <code class="language-plaintext highlighter-rouge">subscriptions</code> that run in the background without effecting other functions. This is done by creating a <code class="language-plaintext highlighter-rouge">Queue</code> with <code class="language-plaintext highlighter-rouge">Bull</code> which is a list of jobs that need to be done in the order that they were added or FIFO (First In, First Out) order.</p> <h3 id="bull"> <a href="#bull" class="anchor-heading" aria-labelledby="bull"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bull </h3> <p>Bull is a Node.js package that allows you to create a Queue and store that Queue inside your Redis datastore. This makes the process a lot faster than storing the Queue information in the database</p> <h3 id="subscribers"> <a href="#subscribers" class="anchor-heading" aria-labelledby="subscribers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Subscribers </h3> <p>Subscribers are jobs that are added to the Bull Queues to be done. They are separated based on services or parts of the website.</p> <p>Example subscriber file:</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Queue</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">bull</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">EmailServices</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../services/EmailServices</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">UserServices</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../services/UserServices</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">announcementSubscription</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Queue</span><span class="p">(</span><span class="dl">"</span><span class="s2">newFrosh</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">redis</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">port</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDIS_PORT</span><span class="p">,</span>
    <span class="na">host</span><span class="p">:</span> <span class="dl">"</span><span class="s2">redis</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">password</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDIS_PASSWORD</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">});</span>

<span class="nx">announcementSubscription</span><span class="p">.</span><span class="nx">process</span><span class="p">((</span><span class="nx">job</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Announcement Created!</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">job</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">unsubed</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">EmailServices</span><span class="p">.</span><span class="nx">sendTemplateEmail</span><span class="p">(</span>
        <span class="p">{},</span>
        <span class="dl">"</span><span class="s2">unsubscribed</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">[</span><span class="nx">job</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">email</span><span class="p">],</span>
        <span class="dl">"</span><span class="s2">tech@orientation.skule.ca</span><span class="dl">"</span>
      <span class="p">);</span>

      <span class="nx">result</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
        <span class="nx">done</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">done</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">bulkEmailEntries</span> <span class="o">=</span> <span class="p">[];</span>

      <span class="nx">UserServices</span><span class="p">.</span><span class="nx">getAllUsers</span><span class="p">().</span><span class="nx">then</span><span class="p">((</span><span class="nx">users</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">entries</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">users</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">canEmail</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">entries</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">bulkEmailEntries</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entries</span><span class="p">);</span>
              <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
              <span class="nx">entries</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">entries</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">bulkEmailEntries</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">entries</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">EmailServices</span><span class="p">.</span><span class="nx">sendBulkTemplateEmail</span><span class="p">(</span>
          <span class="nx">bulkEmailEntries</span><span class="p">,</span>
          <span class="dl">"</span><span class="s2">announcement</span><span class="dl">"</span><span class="p">,</span>
          <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">job</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="na">description</span><span class="p">:</span> <span class="nx">job</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">description</span> <span class="p">},</span>
          <span class="dl">"</span><span class="s2">tech@orientation.skule.ca</span><span class="dl">"</span>
        <span class="p">);</span>

        <span class="nx">result</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">response:</span><span class="dl">"</span><span class="p">);</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
          <span class="nx">done</span><span class="p">();</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">done</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">announcementSubscription</span><span class="p">;</span>
</code></pre></div></div> <p>This file sends a mass email to all F!rosh for inform them of an announcement or send someone an email letting them know they have unsubscribed from announcement emails.</p> <h2 id="mongodb"> <a href="#mongodb" class="anchor-heading" aria-labelledby="mongodb"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MongoDB </h2> <p>MongoDB is a noSQL database that we use to store F!rosh data. Watch these videos:</p> <ul> <li><a href="https://youtu.be/ofme2o29ngU">MongoDB Crash Course</a></li> <li><a href="https://youtu.be/DZBGEVgL2eE">Mongoose Crash Course</a></li> </ul> <h3 id="mongoose"> <a href="#mongoose" class="anchor-heading" aria-labelledby="mongoose"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mongoose </h3> <p>Mongoose is a wrapper for MongoDB that makes interacting with the database a lot more streamlines and easier.</p> <h3 id="models--schemas"> <a href="#models--schemas" class="anchor-heading" aria-labelledby="models--schemas"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Models &amp; Schemas </h3> <p>You can use Mongoose Schemes to create data models that the database will follow when new piece of data are added.</p> <h2 id="aws-ses"> <a href="#aws-ses" class="anchor-heading" aria-labelledby="aws-ses"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> AWS SES </h2> <p>The AWS SES is an API used to send emails from the backend programmatically.</p> <h2 id="stripe"> <a href="#stripe" class="anchor-heading" aria-labelledby="stripe"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stripe </h2> <p>Stripe is the API we use to process payments F!rosh make to pay for F!rosh Week and F!rosh retreat.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
